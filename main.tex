% !TeX encoding = UTF-8
% !TeX program = pdflatex
% !TeX spellcheck = it_IT

\documentclass[english,oneside,LaM,binding=0.6cm]{sapthesis}

\usepackage{amssymb}
\usepackage{microtype}
\usepackage[english]{babel}
\usepackage[utf8]{inputenx}
\usepackage{hyperref}
\hypersetup{
	pdftitle={Neural Network Based steering and Hardware in Loop Simulation of Variable Speed Control Moment Gyroscope},
	pdfauthor={Siddharth Nimbajirao Deore}}

% I guess for biblio
\usepackage[nottoc]{tocbibind}
% for multi line comment
\usepackage{verbatim}

% for subfigures
\usepackage{graphicx}
\usepackage{subcaption}
% for box color box
\usepackage{tcolorbox}
% forced figure placement
\usepackage{float}

\usepackage{svg}

\usepackage{tikz}
\usetikzlibrary{arrows.meta,shadows,positioning,mindmap,backgrounds}
\usetikzlibrary{fadings}
\usepackage[ruled,vlined]{algorithm2e}
% for activation functions
\usepackage{pgfplots}
\pgfplotsset{compat=1.17}
% for neuron
\usetikzlibrary{matrix,chains,positioning,decorations.pathreplacing,arrows}

\usepackage{nomencl}
\makenomenclature

\usepackage[acronym]{glossaries}
\makeglossaries

\usepackage{etoolbox}


% Remove in a normal thesis
%\usepackage{lipsum}
\usepackage{curve2e}
\definecolor{gray}{gray}{0.4}
\newcommand{\bs}{\textbackslash}

% Commands for the titlepage
\title{Neural Network based Steering and \\ Hardware in Loop Simulation of Variable Speed Control Moment Gyroscope}
\author{Siddharth Nimbajirao Deore}
\IDnumber{1823670}

\course{Space and Astronautical Engineering (LM-20)}
\courseorganizer{Dipartimento di Ingegneria Meccanica e Aerospaziale (DIMA)}
\AcademicYear{2019-20}
\copyyear{2020}
\advisor{Prof. Fabio Santoni}
%\coadvisor{}
\authoremail{deore.1823670@studenti.uniroma1.it}
\website{http://deore.in}

\examdate{26th January 2021}
\examiner{Prof. Mauro Valorani}
\examiner{Prof. Francesco Creta}
\examiner{Prof. Giuliano Coppotelli}
\examiner{Prof. Pasquale Tommasino}
\examiner{Prof. Nazzareno Pierdicca}
\examiner{Prof. Daniele Bianchi}

\versiondate{\today}

% For VSCMG Geometries
\usepackage{tikz}
\usepackage{tikz-3dplot}
% Tikz from mathch.io for refrence frame symbol
\usepackage{mathrsfs}

\begin{document}
\frontmatter
\maketitle
\dedication{Dedicated to mother Usha and father N. Z. Deore}

\begin{abstract}
\phantomsection
\addcontentsline{toc}{chapter}{Abstract}
Control Moment Gyroscope (CMG) an attitude control actuator, generates torques utilizing gyroscopic couple by tilting spin axis of high angular momentum wheels. Despite having significantly large torque compared to Reaction Wheels, they pose the problem of singularity. Significant efforts had been made to surmount singularity problem associated with CMG. Variable Speed Control Moment Gyroscope (VSCMG) can avoid singularities by changing flywheel speed to escape singular states. Various singularity avoidance techniques have been proposed such as Singularity Robust Pseudo inverse, and Local Gradient method both are computationally complex and requires fine tuning of weights in steering logic. 

Neural Network based VSCMG attitude control is discussed in this thesis. Neural Networks can approximate any nonlinear function with high accuracy. Nonlinear Dynamics of generic VSCMG and Singularity Robust steering law is realized. Supervised Learning is used to pretrain a deep neural network with trajectories generated from Monte-Carlo simulation of SR-VSCMG steering law. Pre trained neural network is further trained using Proximal Policy Optimization a policy gradient method for Reinforcement Learning in which intelligent agent interacts with environment by taking action based on current state. For each action there is a reward associated based on pre-determined reward function, goal is to maximize the delayed reward. PPO utilizes multiple epochs of minibatch updates instead of one gradient update per sample, this is advantageous since network parameters does not change rapidly consequently complex nonlinear behavior of VSCMG steering is easily approximated. Performance of Neural Network based steering is compared with SR-VSCMG steering via numerical simulations. Results show that trained Neural Network based steering agent is found to be computationally less expensive  and showed significant improvement in computation time over conventional control methods, moreover it is capable of escaping singularities and avoid singular states in large slew maneuver. In proximity of singularity, very high frequency jitters of gimbal angles clearly seen in SR-VSCMG steering law may compromise structural integrity of satellite, proposed technique is inverse free and does not subjected to such high frequency jitters hence clearly advantageous safeguarding structural integrity.

For performance verification of numerical simulations on physical system a low-cost testbed for hardware in loop simulation of Variable Speed Control Moment Gyroscope (VSCMG) is developed. Reconfigurable Attitude Control System test setup comprise of a platform with pyramid cluster of SGCMG units balancing on sharp tip with its center of mass kept close to point of contact to simulate complete rotational freedom in yaw, constrained roll and pitch while restricting translation motion. High bandwidth communication between customized developed ground station software and test bed on-board computers allows just in time updates of controller parameters, real-time visualization of sensor state and switching between various control schemes.
\\
\\
\textbf{Keywords} : VSCMG, Neural Network, Reinforcement Learning, Spacecraft Test Bench , Hardware in Loop Simulation

\end{abstract}

\begin{acknowledgments}
\phantomsection
\addcontentsline{toc}{chapter}{Acknowledgments}
I would like to express deepest sense of gratitude to my thesis advisor Prof. Fabio Santoni for introducing me to complex challenging subject and encouraging me to develop experimental setup to gain practical insights satellite system to bridge gap between theoretical understanding and practical implementation. It was great privilege and honor to work and explore under his guidance. \\
\\
Furthermore, I would like to thank my friend Graziano Ullucci for helping me in various stages to build the prototype and providing manufacturing support for various parts of the project. In addition a special thanks goes to Centro Saperi & Co for permitting me to 3D print few parts amidst global pandemic restriction. \\
\\
Finally, I am extremely grateful to my parents and sisters for their love and support throughout my academic trial.

\end{acknowledgments}


% Table of Contents
\renewcommand{\contentsname}{Table of Contents}
\tableofcontents

% List of Tables
\listoftables
%\addcontentsline{toc}{chapter}{Tables}

% List of Figures
\listoffigures
%\addcontentsline{toc}{chapter}{Figures}

% List of Acronyms (short forms)

\printacronyms[type=\acronymtype, title=List of Acronyms]
\addcontentsline{toc}{chapter}{List of Acronyms}

% List of Glossary
\printglossary[title=Glossary]
\addcontentsline{toc}{chapter}{Glossary}


\nomlabelwidth=25mm 

\renewcommand\nomgroup[1]{%
  \item[\bfseries
  \ifstrequal{#1}{A}{Spacecraft Attitude Dynamics}{%
  \ifstrequal{#1}{B}{AI based Learning Agent}{%
  \ifstrequal{#1}{C}{Other Symbols}{}}}%
]}

% List of Nomenclature renamed as Abbreviations
%\renewcommand{\nomname}{Abbreviations}
\printnomenclature
\addcontentsline{toc}{chapter}{Nomenclature}
% \mbox{}



% add nomenclatures as you write latter it will update here
\nomenclature[A, 01]{$\mathcal{F}_i$}{Inertial reference frame}
\nomenclature[A, 02]{$\mathcal{F}_b$}{Body fixed reference frame}
\nomenclature[A, 03]{$\mathcal{F}_{g}$}{Gimbal Reference frame}
\nomenclature[A, 04]{$\mathbf{R}$}{Rotation matrix}
\nomenclature[A, 05]{$\mathbf{q}$}{Quaternion}
\nomenclature[A, 06]{$q_i$}{Components of Quaternion $i\in\{0,1,2,3\}$}
\nomenclature[A, 07]{$\psi$}{Yaw}
\nomenclature[A, 07]{$\theta$}{Pitch}
\nomenclature[A, 07]{$\phi$}{Roll}
\nomenclature[A, 08]{${q_v}$}{vector component of quaternion}
\nomenclature[A, 09]{$\mathbf{q_d}$}{Desired attitude quaternion}
\nomenclature[A, 10]{$\mathbf{q_e}$}{Attitude error quaternion}
\nomenclature[A, 11]{$\mathbf{\omega}$}{Angular velocity vector}
\nomenclature[A, 12]{$\mathcal{T}$}{Kinetic Energy}
\nomenclature[A, 13]{$\mathcal{H}$}{Angular momentum}
\nomenclature[A, 14]{$\mathcal{H}_P$}{Angular momentum of platform}
\nomenclature[A, 15]{$\mathcal{H}_{CMG}$}{Angular momentum of CMG system}
\nomenclature[A, 16]{$\mathcal{H_{W}}$}{Angular momentum of Reaction wheel}
\nomenclature[A, 17]{$\mathcal{H}_{u}$}{Angular momentum component along singular direction}
\nomenclature[A, 18]{$\mathbf{\tau_e}$}{Environmental Torques}
\nomenclature[A, 19]{$\mathbf{\tau_d}$}{Disturbance Torques}
\nomenclature[A, 20]{$\mathbf{u}$}{Control Torque}
\nomenclature[A, 21]{$ J_p$}{Platform inertia tensor}
\nomenclature[A, 22]{$J_{W}$}{Reaction Wheel inertia}
\nomenclature[A, 23]{$J_{G}$}{Gimbal inertia}
\nomenclature[A, 24]{$J_{CMG}$}{CMG inertia tensor; wheel and gimbal combined}
\nomenclature[A, 25]{$\hat{\mathbf{g}}$}{Gimbal Axis}
\nomenclature[A, 26]{$\hat{\mathbf{s}}$}{Spin Axis}
\nomenclature[A, 27]{$\hat{\mathbf{t}}$}{Transverse Axis}
\nomenclature[A, 28]{$\Omega$}{Reaction Wheel angular velocity}
\nomenclature[A, 29]{$\delta$}{Gimbal angle}
\nomenclature[A, 30]{$\beta$}{VSCMG pyramid skew angle}


\nomenclature[B, 01]{$s \in \mathcal{S}$}{States}
\nomenclature[B, 02]{$a \in \mathcal{A}$}{Actions}
\nomenclature[B, 03]{$r \in \mathcal{R}$}{Rewards}
\nomenclature[B, 04]{$\gamma$}{Discount factor $ 0 < \gamma \leq 1$}
\nomenclature[B, 05]{$G_t$}{Discounted future reward}
\nomenclature[B, 06]{$P(s', r \vert s, a)$}{Transition probability of getting to the next state $s'$ from the current state $s$ with action $a$ and reward $r$}
\nomenclature[B, 07]{$\pi_\theta(\cdot)$}{Policy corresponding to parameter $\theta$}
\nomenclature[B, 08]{$\pi_\theta(a \vert s)$}{Stochastic policy (agent behavior strategy).  Probability of taking action $a$ in state $s$ given parameter vector $\theta$ }
\nomenclature[B, 09]{$\mu(s)$}{Deterministic policy; Either $\pi$ or $\mu$ is learned through reinforcement learning algorithm}
\nomenclature[B, 10]{$V_w(.)$}{Value function parameterized by $w$}
\nomenclature[B, 11]{$V(s)$}{State-value function measures the expected return of state}
\nomenclature[B, 12]{$V^\pi(s)$}{The value of state $s$ with policy $\pi$ is followed}
\nomenclature[B, 13]{$Q_w(.)$}{ Action value function parameterized by $w$}
\nomenclature[B, 14]{$Q(s, a)$}{Action-value function 
evaluates the expected return of a pair of state and action $(s,a)$}
\nomenclature[B, 15]{$Q^\pi(s, a)$}{the value of (state, action) pair with policy $\pi$ is followed}
\nomenclature[B, 16]{$A(s, a)$}{Advantage function $A(s, a) = Q(s, a) - V(s)$}
\nomenclature[B, 17]{$J(\theta)$}{Objective function}
\nomenclature[B, 18]{$d^\pi(s)$}{stationary distribution of Markov chain for $\pi_\theta$}
\nomenclature[B, 19]{$L(\theta)$}{Policy Loss}
\nomenclature[B, 20]{$r(\theta)$}{Probability ratio of new policy over old policy}
\nomenclature[B, 21]{$ \nabla \pi_\theta(a \vert s)$}{column vector of partial derivatives of $\pi_\theta(a \vert s)$ with respect to $\theta$ }
\nomenclature[B, 22]{$\nabla J(\theta)$}{ column vector of partial derivatives of $J(\theta)$ with respect to $\theta$ }


\newacronym{nn}{NN}{Neural Network}



\mainmatter
\begin{comment}
\end{comment}

% Introduction
\input{include/mainmatter/Chapter_1}
%\part{Fundamentals}
% Equation of Motion
\input{include/mainmatter/Chapter_2}
% Singularities
\input{include/mainmatter/Chapter_3}
%  Controller Design
\input{include/mainmatter/Chapter_4}
%  Numerical Sims

\input{include/mainmatter/Chapter_5}
%\part{Artificial Intelligence}
% Neural Network

\input{include/mainmatter/Chapter_6}
%\part{Testbed}
\begin{comment}
\end{comment}

% Mechanical Design
\input{include/mainmatter/Chapter_7}
% Electrical Design
\input{include/mainmatter/Chapter_8}
% Hardware in Loop Simulations
% Mechanical Design
\input{include/mainmatter/Chapter_9}

\input{include/mainmatter/Conclusion}


\appendix


\backmatter
% bibliography
\cleardoublepage
\phantomsection
%\bibliographystyle{sapthesis} % BibTeX style
%\bibliographystyle{apalike}
\bibliographystyle{ieeetr}
\bibliography{bibliography} % BibTeX database without .bib extension
%\addcontentsline{toc}{chapter}{Bibliography}

\end{document}